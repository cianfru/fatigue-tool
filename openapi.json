{
  "openapi": "3.1.0",
  "info": {
    "title": "Fatigue Analysis API",
    "description": "EASA-compliant biomathematical fatigue analysis with sleep quality modeling",
    "version": "4.2.0"
  },
  "paths": {
    "/": {
      "get": {
        "summary": "Root",
        "description": "Health check",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Health check endpoint",
        "operationId": "health_check_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/analyze": {
      "post": {
        "summary": "Analyze Roster",
        "description": "Upload roster file and get fatigue analysis\n\nReturns complete analysis with duty-by-duty breakdown",
        "operationId": "analyze_roster_api_analyze_post",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_analyze_roster_api_analyze_post"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnalysisResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/analysis/{analysis_id}": {
      "get": {
        "summary": "Get Analysis",
        "description": "Retrieve stored analysis by ID",
        "operationId": "get_analysis_api_analysis__analysis_id__get",
        "parameters": [
          {
            "name": "analysis_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Analysis Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/visualize/chronogram": {
      "post": {
        "summary": "Generate Chronogram",
        "description": "Generate high-resolution chronogram image\nReturns base64-encoded PNG",
        "operationId": "generate_chronogram_api_visualize_chronogram_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChronogramRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/visualize/calendar": {
      "post": {
        "summary": "Generate Calendar",
        "description": "Generate aviation calendar image",
        "operationId": "generate_calendar_api_visualize_calendar_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CalendarRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/duty/{analysis_id}/{duty_id}": {
      "get": {
        "summary": "Get Duty Detail",
        "description": "Get detailed timeline data for a single duty\nReturns all performance points for interactive charting",
        "operationId": "get_duty_detail_api_duty__analysis_id___duty_id__get",
        "parameters": [
          {
            "name": "analysis_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Analysis Id"
            }
          },
          {
            "name": "duty_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Duty Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/statistics/{analysis_id}": {
      "get": {
        "summary": "Get Statistics",
        "description": "Get summary statistics for frontend dashboard",
        "operationId": "get_statistics_api_statistics__analysis_id__get",
        "parameters": [
          {
            "name": "analysis_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Analysis Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AnalysisResponse": {
        "properties": {
          "analysis_id": {
            "type": "string",
            "title": "Analysis Id"
          },
          "roster_id": {
            "type": "string",
            "title": "Roster Id"
          },
          "pilot_id": {
            "type": "string",
            "title": "Pilot Id"
          },
          "pilot_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Pilot Name"
          },
          "pilot_base": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Pilot Base"
          },
          "pilot_aircraft": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Pilot Aircraft"
          },
          "month": {
            "type": "string",
            "title": "Month"
          },
          "total_duties": {
            "type": "integer",
            "title": "Total Duties"
          },
          "total_sectors": {
            "type": "integer",
            "title": "Total Sectors"
          },
          "total_duty_hours": {
            "type": "number",
            "title": "Total Duty Hours"
          },
          "total_block_hours": {
            "type": "number",
            "title": "Total Block Hours"
          },
          "high_risk_duties": {
            "type": "integer",
            "title": "High Risk Duties"
          },
          "critical_risk_duties": {
            "type": "integer",
            "title": "Critical Risk Duties"
          },
          "total_pinch_events": {
            "type": "integer",
            "title": "Total Pinch Events"
          },
          "avg_sleep_per_night": {
            "type": "number",
            "title": "Avg Sleep Per Night"
          },
          "max_sleep_debt": {
            "type": "number",
            "title": "Max Sleep Debt"
          },
          "worst_duty_id": {
            "type": "string",
            "title": "Worst Duty Id"
          },
          "worst_performance": {
            "type": "number",
            "title": "Worst Performance"
          },
          "duties": {
            "items": {
              "$ref": "#/components/schemas/DutyResponse"
            },
            "type": "array",
            "title": "Duties"
          },
          "rest_days_sleep": {
            "items": {
              "$ref": "#/components/schemas/RestDaySleepResponse"
            },
            "type": "array",
            "title": "Rest Days Sleep",
            "default": []
          }
        },
        "type": "object",
        "required": [
          "analysis_id",
          "roster_id",
          "pilot_id",
          "pilot_name",
          "pilot_base",
          "pilot_aircraft",
          "month",
          "total_duties",
          "total_sectors",
          "total_duty_hours",
          "total_block_hours",
          "high_risk_duties",
          "critical_risk_duties",
          "total_pinch_events",
          "avg_sleep_per_night",
          "max_sleep_debt",
          "worst_duty_id",
          "worst_performance",
          "duties"
        ],
        "title": "AnalysisResponse"
      },
      "Body_analyze_roster_api_analyze_post": {
        "properties": {
          "file": {
            "type": "string",
            "format": "binary",
            "title": "File"
          },
          "pilot_id": {
            "type": "string",
            "title": "Pilot Id",
            "default": "P12345"
          },
          "month": {
            "type": "string",
            "title": "Month",
            "default": "2026-02"
          },
          "home_base": {
            "type": "string",
            "title": "Home Base",
            "default": "DOH"
          },
          "home_timezone": {
            "type": "string",
            "title": "Home Timezone",
            "default": "Asia/Qatar"
          },
          "config_preset": {
            "type": "string",
            "title": "Config Preset",
            "default": "default"
          }
        },
        "type": "object",
        "required": [
          "file"
        ],
        "title": "Body_analyze_roster_api_analyze_post"
      },
      "CalendarRequest": {
        "properties": {
          "analysis_id": {
            "type": "string",
            "title": "Analysis Id"
          },
          "theme": {
            "type": "string",
            "title": "Theme",
            "default": "light"
          }
        },
        "type": "object",
        "required": [
          "analysis_id"
        ],
        "title": "CalendarRequest"
      },
      "ChronogramRequest": {
        "properties": {
          "analysis_id": {
            "type": "string",
            "title": "Analysis Id"
          },
          "mode": {
            "type": "string",
            "title": "Mode",
            "default": "risk"
          },
          "theme": {
            "type": "string",
            "title": "Theme",
            "default": "light"
          },
          "show_annotations": {
            "type": "boolean",
            "title": "Show Annotations",
            "default": true
          }
        },
        "type": "object",
        "required": [
          "analysis_id"
        ],
        "title": "ChronogramRequest"
      },
      "DutyResponse": {
        "properties": {
          "duty_id": {
            "type": "string",
            "title": "Duty Id"
          },
          "date": {
            "type": "string",
            "title": "Date"
          },
          "report_time_utc": {
            "type": "string",
            "title": "Report Time Utc"
          },
          "release_time_utc": {
            "type": "string",
            "title": "Release Time Utc"
          },
          "duty_hours": {
            "type": "number",
            "title": "Duty Hours"
          },
          "sectors": {
            "type": "integer",
            "title": "Sectors"
          },
          "segments": {
            "items": {
              "$ref": "#/components/schemas/DutySegmentResponse"
            },
            "type": "array",
            "title": "Segments"
          },
          "min_performance": {
            "type": "number",
            "title": "Min Performance"
          },
          "avg_performance": {
            "type": "number",
            "title": "Avg Performance"
          },
          "landing_performance": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Landing Performance"
          },
          "sleep_debt": {
            "type": "number",
            "title": "Sleep Debt"
          },
          "wocl_hours": {
            "type": "number",
            "title": "Wocl Hours"
          },
          "prior_sleep": {
            "type": "number",
            "title": "Prior Sleep"
          },
          "risk_level": {
            "type": "string",
            "title": "Risk Level"
          },
          "is_reportable": {
            "type": "boolean",
            "title": "Is Reportable"
          },
          "pinch_events": {
            "type": "integer",
            "title": "Pinch Events"
          },
          "max_fdp_hours": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Max Fdp Hours"
          },
          "extended_fdp_hours": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Extended Fdp Hours"
          },
          "used_discretion": {
            "type": "boolean",
            "title": "Used Discretion"
          },
          "sleep_quality": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/SleepQualityResponse"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "duty_id",
          "date",
          "report_time_utc",
          "release_time_utc",
          "duty_hours",
          "sectors",
          "segments",
          "min_performance",
          "avg_performance",
          "landing_performance",
          "sleep_debt",
          "wocl_hours",
          "prior_sleep",
          "risk_level",
          "is_reportable",
          "pinch_events",
          "max_fdp_hours",
          "extended_fdp_hours",
          "used_discretion"
        ],
        "title": "DutyResponse"
      },
      "DutySegmentResponse": {
        "properties": {
          "flight_number": {
            "type": "string",
            "title": "Flight Number"
          },
          "departure": {
            "type": "string",
            "title": "Departure"
          },
          "arrival": {
            "type": "string",
            "title": "Arrival"
          },
          "departure_time": {
            "type": "string",
            "title": "Departure Time"
          },
          "arrival_time": {
            "type": "string",
            "title": "Arrival Time"
          },
          "departure_time_local": {
            "type": "string",
            "title": "Departure Time Local"
          },
          "arrival_time_local": {
            "type": "string",
            "title": "Arrival Time Local"
          },
          "block_hours": {
            "type": "number",
            "title": "Block Hours"
          }
        },
        "type": "object",
        "required": [
          "flight_number",
          "departure",
          "arrival",
          "departure_time",
          "arrival_time",
          "departure_time_local",
          "arrival_time_local",
          "block_hours"
        ],
        "title": "DutySegmentResponse"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "RestDaySleepResponse": {
        "properties": {
          "date": {
            "type": "string",
            "title": "Date"
          },
          "sleep_blocks": {
            "items": {
              "$ref": "#/components/schemas/SleepBlockResponse"
            },
            "type": "array",
            "title": "Sleep Blocks"
          },
          "total_sleep_hours": {
            "type": "number",
            "title": "Total Sleep Hours"
          },
          "effective_sleep_hours": {
            "type": "number",
            "title": "Effective Sleep Hours"
          },
          "sleep_efficiency": {
            "type": "number",
            "title": "Sleep Efficiency"
          },
          "strategy_type": {
            "type": "string",
            "title": "Strategy Type"
          },
          "confidence": {
            "type": "number",
            "title": "Confidence"
          }
        },
        "type": "object",
        "required": [
          "date",
          "sleep_blocks",
          "total_sleep_hours",
          "effective_sleep_hours",
          "sleep_efficiency",
          "strategy_type",
          "confidence"
        ],
        "title": "RestDaySleepResponse",
        "description": "Sleep pattern for a rest day (no duties)"
      },
      "SleepBlockResponse": {
        "properties": {
          "sleep_start_time": {
            "type": "string",
            "title": "Sleep Start Time"
          },
          "sleep_end_time": {
            "type": "string",
            "title": "Sleep End Time"
          },
          "sleep_start_iso": {
            "type": "string",
            "title": "Sleep Start Iso"
          },
          "sleep_end_iso": {
            "type": "string",
            "title": "Sleep End Iso"
          },
          "sleep_type": {
            "type": "string",
            "title": "Sleep Type"
          },
          "duration_hours": {
            "type": "number",
            "title": "Duration Hours"
          },
          "effective_hours": {
            "type": "number",
            "title": "Effective Hours"
          },
          "quality_factor": {
            "type": "number",
            "title": "Quality Factor"
          },
          "sleep_start_day": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Day"
          },
          "sleep_start_hour": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Hour"
          },
          "sleep_end_day": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Day"
          },
          "sleep_end_hour": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Hour"
          }
        },
        "type": "object",
        "required": [
          "sleep_start_time",
          "sleep_end_time",
          "sleep_start_iso",
          "sleep_end_iso",
          "sleep_type",
          "duration_hours",
          "effective_hours",
          "quality_factor"
        ],
        "title": "SleepBlockResponse",
        "description": "Individual sleep period with timing"
      },
      "SleepQualityResponse": {
        "properties": {
          "total_sleep_hours": {
            "type": "number",
            "title": "Total Sleep Hours"
          },
          "effective_sleep_hours": {
            "type": "number",
            "title": "Effective Sleep Hours"
          },
          "sleep_efficiency": {
            "type": "number",
            "title": "Sleep Efficiency"
          },
          "wocl_overlap_hours": {
            "type": "number",
            "title": "Wocl Overlap Hours"
          },
          "sleep_strategy": {
            "type": "string",
            "title": "Sleep Strategy"
          },
          "confidence": {
            "type": "number",
            "title": "Confidence"
          },
          "warnings": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Warnings"
          },
          "sleep_blocks": {
            "items": {
              "$ref": "#/components/schemas/SleepBlockResponse"
            },
            "type": "array",
            "title": "Sleep Blocks",
            "default": []
          },
          "sleep_start_time": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Time"
          },
          "sleep_end_time": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Time"
          },
          "sleep_start_iso": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Iso"
          },
          "sleep_end_iso": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Iso"
          },
          "sleep_start_day": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Day"
          },
          "sleep_start_hour": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep Start Hour"
          },
          "sleep_end_day": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Day"
          },
          "sleep_end_hour": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sleep End Hour"
          }
        },
        "type": "object",
        "required": [
          "total_sleep_hours",
          "effective_sleep_hours",
          "sleep_efficiency",
          "wocl_overlap_hours",
          "sleep_strategy",
          "confidence",
          "warnings"
        ],
        "title": "SleepQualityResponse",
        "description": "Sleep quality analysis from enhanced strategic estimator"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}